"use strict";(self.webpackChunkdoc_besu=self.webpackChunkdoc_besu||[]).push([[74412],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>f});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(a),u=o,f=p["".concat(s,".").concat(u)]||p[u]||m[u]||r;return a?n.createElement(f,i(i({ref:t},c),{},{components:a})):n.createElement(f,i({ref:t},c))}));function f(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},85162:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(67294),o=a(86010);const r="tabItem_Ymn6";function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(r,i),hidden:a},t)}},74866:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(87462),o=a(67294),r=a(86010),i=a(12466),l=a(16550),s=a(91980),d=a(67392),c=a(50012);function p(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:o}}=e;return{value:t,label:a,attributes:n,default:o}}))}function m(e){const{values:t,children:a}=e;return(0,o.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,d.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function u(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.k6)(),r=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,s._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function b(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,r=m(e),[i,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!u({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:r}))),[s,d]=f({queryString:a,groupId:n}),[p,b]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,r]=(0,c.Nk)(a);return[n,(0,o.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:n}),k=(()=>{const e=s??p;return u({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{k&&l(k)}),[k]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!u({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)}),[d,b,r]),tabValues:r}}var k=a(72389);const h="tabList__CuJ",g="tabItem_LNqP";function N(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:d}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),m=e=>{const t=e.currentTarget,a=c.indexOf(t),n=d[a].value;n!==l&&(p(t),s(n))},u=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":a},t)},d.map((e=>{let{value:t,label:a,attributes:i}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:u,onClick:m},i,{className:(0,r.Z)("tabs__item",g,i?.className,{"tabs__item--active":l===t})}),a??t)})))}function v(e){let{lazy:t,children:a,selectedValue:n}=e;const r=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===n));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function w(e){const t=b(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",h)},o.createElement(N,(0,n.Z)({},e,t)),o.createElement(v,(0,n.Z)({},e,t)))}function y(e){const t=(0,k.Z)();return o.createElement(w,(0,n.Z)({key:String(t)},e))}},12553:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>d,toc:()=>p});var n=a(87462),o=(a(67294),a(3905)),r=a(74866),i=a(85162);const l={title:"QBFT",description:"Hyperledger Besu QBFT proof of authority (PoA) consensus protocol implementation",sidebar_position:2,tags:["private networks"]},s="Configure QBFT consensus",d={unversionedId:"private-networks/how-to/configure/consensus/qbft",id:"version-23.7.1/private-networks/how-to/configure/consensus/qbft",title:"QBFT",description:"Hyperledger Besu QBFT proof of authority (PoA) consensus protocol implementation",source:"@site/versioned_docs/version-23.7.1/private-networks/how-to/configure/consensus/qbft.md",sourceDirName:"private-networks/how-to/configure/consensus",slug:"/private-networks/how-to/configure/consensus/qbft",permalink:"/private-networks/how-to/configure/consensus/qbft",draft:!1,editUrl:"https://github.com/hyperledger/besu-docs/tree/main/versioned_docs/version-23.7.1/private-networks/how-to/configure/consensus/qbft.md",tags:[{label:"private networks",permalink:"/tags/private-networks"}],version:"23.7.1",lastUpdatedAt:1694055692,formattedLastUpdatedAt:"Sep 7, 2023",sidebarPosition:2,frontMatter:{title:"QBFT",description:"Hyperledger Besu QBFT proof of authority (PoA) consensus protocol implementation",sidebar_position:2,tags:["private networks"]},sidebar:"privateDocSidebar",previous:{title:"Consensus protocols",permalink:"/private-networks/how-to/configure/consensus/"},next:{title:"IBFT 2.0",permalink:"/private-networks/how-to/configure/consensus/ibft"}},c={},p=[{value:"Genesis file",id:"genesis-file",level:2},{value:"Extra data",id:"extra-data",level:3},{value:"Generate extra data",id:"generate-extra-data",level:4},{value:"Block time",id:"block-time",level:3},{value:"Tune block timeout",id:"tune-block-timeout",level:4},{value:"Optional configuration options",id:"optional-configuration-options",level:3},{value:"Post-Merge configuration",id:"post-merge-configuration",level:3},{value:"Add and remove validators",id:"add-and-remove-validators",level:2},{value:"Add and remove validators using block headers",id:"add-and-remove-validators-using-block-headers",level:3},{value:"Add a validator",id:"add-a-validator",level:4},{value:"Remove a validator",id:"remove-a-validator",level:4},{value:"Epoch transition",id:"epoch-transition",level:4},{value:"Add and remove validators using a smart contract",id:"add-and-remove-validators-using-a-smart-contract",level:3},{value:"Minimum number of validators",id:"minimum-number-of-validators",level:3},{value:"Transitions",id:"transitions",level:2},{value:"Configure block time on an existing network",id:"configure-block-time-on-an-existing-network",level:3},{value:"Configure block rewards on an existing network deployment",id:"configure-block-rewards-on-an-existing-network-deployment",level:3},{value:"Swap validator management methods",id:"swap-validator-management-methods",level:3},{value:"Configure the mining beneficiary on an existing network deployment",id:"configure-the-mining-beneficiary-on-an-existing-network-deployment",level:3}],m={toc:p};function u(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"configure-qbft-consensus"},"Configure QBFT consensus"),(0,o.kt)("p",null,"Hyperledger Besu implements the QBFT proof of authority (PoA) ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/how-to/configure/consensus/"},"consensus protocol"),". QBFT is the recommended enterprise-grade consensus protocol for private networks."),(0,o.kt)("p",null,"In QBFT networks, approved accounts, known as validators, validate transactions and blocks. Validators take turns to create the next block. Before inserting the block onto the chain, a super-majority (greater than or equal to 2/3) of validators must first sign the block."),(0,o.kt)("p",null,"Existing validators propose and vote to ",(0,o.kt)("a",{parentName:"p",href:"#add-and-remove-validators"},"add or remove validators"),"."),(0,o.kt)("p",null,"You can ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/tutorials/qbft"},"create a private network using QBFT"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Configure your network to ensure you never lose more than 1/3 your validators. If more than 1/3 of validators stop participating, new blocks are no longer created, and the network stalls. It may take significant time to recover once nodes are restarted.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can use a plugin to securely store a validator's key using the ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#security-module"},(0,o.kt)("inlineCode",{parentName:"a"},"--security-module"))," option.")),(0,o.kt)("h2",{id:"genesis-file"},"Genesis file"),(0,o.kt)("p",null,"To use QBFT, define a ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/concepts/genesis-file"},"genesis file")," that contains the QBFT properties."),(0,o.kt)("p",null,"The genesis file differs depending on the ",(0,o.kt)("a",{parentName:"p",href:"#add-and-remove-validators"},"validator management method")," you intend to use."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"You can use a ",(0,o.kt)("a",{parentName:"p",href:"#transitions"},"transitions")," to change the ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," or validator management method of the network at a later time.")),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{label:"Block header validator selection",value:"tab1",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "config": {\n    "chainid": 1337,\n    "berlinBlock": 0,\n    "qbft": {\n      "epochlength": 30000,\n      "blockperiodseconds": 5,\n      "requesttimeoutseconds": 10\n    }\n  },\n  "nonce": "0x0",\n  "timestamp": "0x5b3d92d7",\n  "extraData": "0xf87aa00000000000000000000000000000000000000000000000000000000000000000f8549464a702e6263b7297a96638cac6ae65e6541f4169943923390ad55e90c237593b3b0e401f3b08a0318594aefdb9a738c9f433e5b6b212a6d62f6370c2f69294c7eeb9a4e00ce683cf93039b212648e01c6c6b78c080c0",\n  "gasLimit": "0x29b92700",\n  "difficulty": "0x1",\n  "mixHash": "0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365",\n  "coinbase": "0x0000000000000000000000000000000000000000",\n  "alloc": {\n    "64d9be4177f418bcf4e56adad85f33e3a64efe22": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "9f66f8a0f0a6537e4a36aa1799673ea7ae97a166": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "a7f25969fb6f3d5ac09a88862c90b5ff664557a7": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "f4bbfd32c11c9d63e9b4c77bb225810f840342df": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    }\n  },\n  "number": "0x0",\n  "gasUsed": "0x0",\n  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"\n}\n'))),(0,o.kt)(i.Z,{label:"Contract validator selection",value:"tab2",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "config": {\n    "chainid": 1337,\n    "berlinBlock": 0,\n    "qbft": {\n      "epochlength": 30000,\n      "blockperiodseconds": 5,\n      "requesttimeoutseconds": 10,\n      "validatorcontractaddress": "0x0000000000000000000000000000000000007777"\n    }\n  },\n  "nonce": "0x0",\n  "timestamp": "0x5b3d92d7",\n  "extraData": "0xe5a00000000000000000000000000000000000000000000000000000000000000000c0c080c0",\n  "gasLimit": "0x29b92700",\n  "difficulty": "0x1",\n  "mixHash": "0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365",\n  "coinbase": "0x0000000000000000000000000000000000000000",\n  "alloc": {\n    "64d9be4177f418bcf4e56adad85f33e3a64efe22": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "9f66f8a0f0a6537e4a36aa1799673ea7ae97a166": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "a7f25969fb6f3d5ac09a88862c90b5ff664557a7": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "f4bbfd32c11c9d63e9b4c77bb225810f840342df": {\n      "balance": "0x446c3b15f9926687d2c40534fdb564000000000000"\n    },\n    "0x0000000000000000000000000000000000007777": {\n      "comment": "validator smart contract",\n      "balance": "0",\n      "code": "0x608060405234801561001057600080fd5b50600436106100a5576000357c0100000000000000000000000000000000000000000000000000000000900480639692ea25116100785780639692ea2514610113578063b4ec9ac114610126578063b7ab4db514610139578063c76f24371461014e57600080fd5b80631c5a9d9c146100aa578063508adcfc146100bf57806351b42b00146100db5780635dc43899146100e3575b600080fd5b6100bd6100b8366004611399565b610161565b005b6100c860035481565b6040519081526020015b60405180910390f35b6100bd6104aa565b6100f66100f1366004611399565b61074e565b6040805193845260208401929092521515908201526060016100d2565b6100bd610121366004611399565b610bbd565b6100bd610134366004611399565b610deb565b6101416110a3565b6040516100d291906113c9565b6100bd61015c366004611399565b611105565b3360009081526001602052604090205460ff1661019c5760405160e560020a62461bcd02815260040161019390611416565b60405180910390fd5b600160a060020a03811661021b5760405160e560020a62461bcd02815260206004820152602860248201527f63616e6e6f742061637469766174652076616c696461746f722077697468206160448201527f64647265737320300000000000000000000000000000000000000000000000006064820152608401610193565b60005b6000548110156102b7576000818154811061023b5761023b611505565b600091825260209091200154600160a060020a03838116911614156102a55760405160e560020a62461bcd02815260206004820152601b60248201527f76616c696461746f7220697320616c72656164792061637469766500000000006044820152606401610193565b806102af816114b8565b91505061021e565b33600090815260016020526040902054610100900460ff16156103345733600090815260016020526040812054815484929162010000900460ff1690811061030157610301611505565b9060005260206000200160006101000a815481600160a060020a030219169083600160a060020a03160217905550610432565b600054610100116103b05760405160e560020a62461bcd02815260206004820152602e60248201527f6e756d626572206f662076616c696461746f72732063616e6e6f74206265206c60448201527f6172676572207468616e203235360000000000000000000000000000000000006064820152608401610193565b3360009081526001602081905260408220805461ff001981166101009081178355845460ff16620100000262ffff001990921691909117179055815490810182559080527f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563018054600160a060020a038416600160a060020a03199091161790555b600160a060020a0382166000818152600260205260408082208054600160a060020a03191633908117909155915490519192917fbdea108da876d927928b65816d521f940fd6dc068dc0e02ba434e0ed0f2d915f9161049e916001909182521515602082015260400190565b60405180910390a35050565b3360009081526001602052604090205460ff166104dc5760405160e560020a62461bcd02815260040161019390611416565b6000546001106105315760405160e560020a62461bcd02815260206004820181905260248201527f63616e6e6f742064656163746976617465206c6173742076616c696461746f726044820152606401610193565b33600090815260016020526040902054610100900460ff166105be5760405160e560020a62461bcd02815260206004820152602860248201527f73656e64657220646f6573206e6f74206861766520616e20616374697665207660448201527f616c696461746f720000000000000000000000000000000000000000000000006064820152608401610193565b336000908152600160205260408120805461ff0019169081905581546201000090910460ff1691908190839081106105f8576105f8611505565b60009182526020822001548154600160a060020a03909116925081906106209060019061148a565b8154811061063057610630611505565b60009182526020822001548154600160a060020a03909116925082919060ff861690811061066057610660611505565b60009182526020808320919091018054600160a060020a031916600160a060020a03948516179055838316825260028152604080832054909316825260019052908120805462ff000019166201000060ff8716021790558054806106c6576106c66114ec565b6000828152602080822060001990840181018054600160a060020a03199081169091559301909355600160a060020a03851680825260028452604080832080549094169093558154835190815293840191909152339290917fbdea108da876d927928b65816d521f940fd6dc068dc0e02ba434e0ed0f2d915f910160405180910390a3505050565b336000908152600160205260408120548190819060ff166107845760405160e560020a62461bcd02815260040161019390611416565b60005b600160a060020a03851660009081526004602052604090205481101561082357600160a060020a038516600090815260046020526040812080546001929190849081106107d6576107d6611505565b6000918252602080832090910154600160a060020a0316835282019290925260400190205460ff1615610811578361080d816114b8565b9450505b8061081b816114b8565b915050610787565b5060026003546108339190611465565b831115610b8657600160a060020a038416600090815260046020526040812061085b9161135f565b600160a060020a03841660009081526001602052604090205460ff1615610ab0576003805490600061088c836114a1565b9091555050600160a060020a038416600090815260016020526040902054610100900460ff1615610a89576000546001106109325760405160e560020a62461bcd02815260206004820152603860248201527f63616e6e6f742072656d6f766520616c6c6f776564206163636f756e7420776960448201527f7468206c617374206163746976652076616c696461746f7200000000000000006064820152608401610193565b600160a060020a03841660009081526001602052604081205481546201000090910460ff169160029181908490811061096d5761096d611505565b6000918252602080832090910154600160a060020a0316835282019290925260400181208054600160a060020a0319169055805481906109af9060019061148a565b815481106109bf576109bf611505565b60009182526020822001548154600160a060020a03909116925082919060ff85169081106109ef576109ef611505565b600091825260208220018054600160a060020a031916600160a060020a039390931692909217909155805480610a2757610a276114ec565b6000828152602080822083016000199081018054600160a060020a0319169055909201909255600160a060020a0392831682526002815260408083205490931682526001905220805460ff909216620100000262ff0000199092169190911790555b600160a060020a0384166000908152600160205260409020805462ffffff19169055610b32565b60038054906000610ac0836114b8565b909155505060408051606081018252600180825260006020808401828152848601838152600160a060020a038b16845293909152939020915182549351915160ff16620100000262ff0000199215156101000261ff00199215159290921661ffff199095169490941717169190911790555b600160a060020a03841660008181526001602090815260409182902054915160ff909216151582527f94154efdb7741591680558a88682943a481f1a468cb81f46fe7f8cead2e40519910160405180910390a25b826002600354610b969190611465565b610ba190600161144d565b6002600354610bb09190611465565b9196909550931192915050565b3360009081526001602052604090205460ff16610bef5760405160e560020a62461bcd02815260040161019390611416565b60005b600160a060020a038216600090815260046020526040902054811015610d4b57600160a060020a0382166000908152600460205260409020805433919083908110610c3f57610c3f611505565b600091825260209091200154600160a060020a03161415610d3957600160a060020a03821660009081526004602052604090208054610c809060019061148a565b81548110610c9057610c90611505565b6000918252602080832090910154600160a060020a03858116845260049092526040909220805491909216919083908110610ccd57610ccd611505565b60009182526020808320919091018054600160a060020a031916600160a060020a039485161790559184168152600490915260409020805480610d1257610d126114ec565b60008281526020902081016000199081018054600160a060020a0319169055019055610d4b565b80610d43816114b8565b915050610bf2565b50600160a060020a0381166000818152600460205260409020546003543392917f91ad81c76cda7c0ccc324838ae74757eab38b250da52daab154daf408cb3bcba91610d9990600290611465565b610da490600161144d565b600160a060020a0386166000908152600160208181526040928390205483519586529085019390935260ff909216159083015260608201526080015b60405180910390a350565b3360009081526001602052604090205460ff16610e1d5760405160e560020a62461bcd02815260040161019390611416565b600160a060020a038116610e765760405160e560020a62461bcd02815260206004820152601f60248201527f6163636f756e7420746f2062652061646465642063616e6e6f742062652030006044820152606401610193565b600160a060020a03811660009081526001602081905260409091205460ff16151514610f0d5760405160e560020a62461bcd02815260206004820152602a60248201527f6163636f756e7420746f2072656d6f7665206973206e6f74206f6e207468652060448201527f616c6c6f77206c697374000000000000000000000000000000000000000000006064820152608401610193565b60005b600160a060020a038216600090815260046020526040902054811015610ffb57600160a060020a0382166000908152600460205260409020805433919083908110610f5d57610f5d611505565b600091825260209091200154600160a060020a03161415610fe95760405160e560020a62461bcd02815260206004820152602a60248201527f73656e6465722068617320616c726561647920766f74656420746f2072656d6f60448201527f7665206163636f756e74000000000000000000000000000000000000000000006064820152608401610193565b80610ff3816114b8565b915050610f10565b50600160a060020a0381166000818152600460209081526040822080546001810182558184529183209091018054600160a060020a0319163390811790915591839052546003549192917f91ad81c76cda7c0ccc324838ae74757eab38b250da52daab154daf408cb3bcba919061107490600290611465565b61107f90600161144d565b60408051928352602083019190915260009082018190526060820152608001610de0565b606060008054806020026020016040519081016040528092919081815260200182805480156110fb57602002820191906000526020600020905b8154600160a060020a031681526001909101906020018083116110dd575b5050505050905090565b3360009081526001602052604090205460ff166111375760405160e560020a62461bcd02815260040161019390611416565b600160a060020a03811660009081526001602052604090205460ff16156111c95760405160e560020a62461bcd02815260206004820152602b60248201527f6163636f756e7420746f2061646420697320616c7265616479206f6e2074686560448201527f20616c6c6f77206c6973740000000000000000000000000000000000000000006064820152608401610193565b60005b600160a060020a0382166000908152600460205260409020548110156112b757600160a060020a038216600090815260046020526040902080543391908390811061121957611219611505565b600091825260209091200154600160a060020a031614156112a55760405160e560020a62461bcd02815260206004820152602760248201527f73656e6465722068617320616c726561647920766f74656420746f206164642060448201527f6163636f756e74000000000000000000000000000000000000000000000000006064820152608401610193565b806112af816114b8565b9150506111cc565b50600160a060020a0381166000818152600460209081526040822080546001810182558184529183209091018054600160a060020a0319163390811790915591839052546003549192917f91ad81c76cda7c0ccc324838ae74757eab38b250da52daab154daf408cb3bcba919061133090600290611465565b61133b90600161144d565b60408051928352602083019190915260019082015260006060820152608001610de0565b508054600082559060005260206000209081019061137d9190611380565b50565b5b808211156113955760008155600101611381565b5090565b6000602082840312156113ab57600080fd5b8135600160a060020a03811681146113c257600080fd5b9392505050565b6020808252825182820181905260009190848201906040850190845b8181101561140a578351600160a060020a0316835292840192918401916001016113e5565b50909695505050505050565b6020808252601f908201527f73656e646572206973206e6f74206f6e2074686520616c6c6f77206c69737400604082015260600190565b60008219821115611460576114606114d3565b500190565b6000826114855760e060020a634e487b7102600052601260045260246000fd5b500490565b60008282101561149c5761149c6114d3565b500390565b6000816114b0576114b06114d3565b506000190190565b60006000198214156114cc576114cc6114d3565b5060010190565b60e060020a634e487b7102600052601160045260246000fd5b60e060020a634e487b7102600052603160045260246000fd5b60e060020a634e487b7102600052603260045260246000fdfea26469706673582212200c3e9c07521b155532c0de1605aae52f4ae953670f0afb0f30d320580b93213d64736f6c63430008070033",\n      "storage": {\n        "0000000000000000000000000000000000000000000000000000000000000000": "0000000000000000000000000000000000000000000000000000000000000002",\n        "290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563": "0000000000000000000000009a6d82ef3912d5ab60473124bccd2f2a640769d7",\n        "290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e564": "00000000000000000000000065463bf6268e5cc409b6501ec846487b935a1446",\n        "aedead2c33b41c31b4afd2246c6bf5131c209d4b0ca6c2247778ac7be7443a00": "0000000000000000000000000000000000000000000000000000000000000101",\n        "33784757d5da236467d27a7c5b0cc5aa9026ca3b79e29106a67a5e93c292a523": "0000000000000000000000000000000000000000000000000000000000010101",\n        "35aba1eb0bbe741ac01e5b6ce584bc042b1a0b7d115eb8f7dd02a1a1de2fd14d": "000000000000000000000000fe3b557e8fb62b89f4916b721be55ceb828dbd73",\n        "0d9217f0a1f7c602fd67052d20171ff73b156d1b87ea258cb6a5d94f71298158": "000000000000000000000000627306090abab3a6e1400e9345bc60c78a8bef57",\n        "0000000000000000000000000000000000000000000000000000000000000003": "0000000000000000000000000000000000000000000000000000000000000002"\n      },\n      "version": "0x01"\n    }\n  },\n  "number": "0x0",\n  "gasUsed": "0x0",\n  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"\n}\n')))),(0,o.kt)("p",null,"The QBFT properties are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"blockperiodseconds")," - The minimum block time, in seconds."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"epochlength")," - The number of blocks after which to reset all votes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"requesttimeoutseconds")," - The timeout for each consensus round before a round change, in seconds."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"blockreward")," - Optional reward amount in Wei to reward the beneficiary. Defaults to zero (0). Can be specified as a hexadecimal (with 0x prefix) or decimal string value. If set, then all nodes on the network must use the identical value."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"validatorcontractaddress")," - Address of the validator smart contract. Required only if using a contract validator selection. The address must be identical to the address in the ",(0,o.kt)("inlineCode",{parentName:"li"},"alloc")," section. This option can also be used in the ",(0,o.kt)("a",{parentName:"li",href:"#transitions"},"transitions")," configuration item if swapping ",(0,o.kt)("a",{parentName:"li",href:"#add-and-remove-validators"},"validator management methods")," in an existing network."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"miningbeneficiary")," - Optional beneficiary of the ",(0,o.kt)("inlineCode",{parentName:"li"},"blockreward"),". Defaults to the validator that proposes the block. If set, then all nodes on the network must use the same beneficiary."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#extra-data"},(0,o.kt)("inlineCode",{parentName:"a"},"extraData"))," - RLP encoded ",(0,o.kt)("a",{parentName:"li",href:"#extra-data"},"extra data"),".")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"We don't recommend changing ",(0,o.kt)("inlineCode",{parentName:"p"},"epochlength")," in a running network. Changing the ",(0,o.kt)("inlineCode",{parentName:"p"},"epochlength")," after genesis can result in illegal blocks.")),(0,o.kt)("admonition",{title:"Invalid block header error",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"When adding a new node, if a ",(0,o.kt)("inlineCode",{parentName:"p"},"TimeStampMoreRecentThanParent | Invalid block header")," error occurs, the genesis file of the new node specifies a higher ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," than the imported chain. The imported chain makes new blocks faster than the genesis file allows and Besu rejects them with this error. This error most often occurs when importing chains from older versions of Besu."),(0,o.kt)("p",{parentName:"admonition"},"Decrease the ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," in the new QBFT genesis file to a lower value that satisfies the block header validation."),(0,o.kt)("p",{parentName:"admonition"},"If the error reads ",(0,o.kt)("inlineCode",{parentName:"p"},"| TimestampMoreRecentThanParent | Invalid block header: timestamp 1619660141 is only 3 seconds newer than parent timestamp 1619660138. Minimum 4 seconds"),", decrease the ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," from 4 seconds to 3 seconds to match the imported chain."),(0,o.kt)("p",{parentName:"admonition"},"After you update the new genesis file, if the imported chain has a ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," value set lower than you prefer, you can adjust it by ",(0,o.kt)("a",{parentName:"p",href:"#configure-block-time-on-an-existing-network"},"configuring the block time on an existing QBFT network"),".")),(0,o.kt)("p",null,"The properties with specific values in the QBFT genesis files are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"difficulty")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"0x1")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"mixHash")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365")," for Istanbul block identification")),(0,o.kt)("p",null,"To start a node on a QBFT private network, use the ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#genesis-file"},(0,o.kt)("inlineCode",{parentName:"a"},"--genesis-file"))," option to specify the custom genesis file."),(0,o.kt)("h3",{id:"extra-data"},"Extra data"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"extraData")," property is an RLP encoding of:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"32 bytes of vanity data."),(0,o.kt)("li",{parentName:"ul"},"If using:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#add-and-remove-validators-using-block-headers"},"Block header validator selection"),", a list of validator addresses."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#add-and-remove-validators-using-a-smart-contract"},"Contract validator selection"),", no validators."))),(0,o.kt)("li",{parentName:"ul"},"Any validator votes. No vote is included in the genesis block."),(0,o.kt)("li",{parentName:"ul"},"The round the block was created on. The round in the genesis block is 0."),(0,o.kt)("li",{parentName:"ul"},"A list of seals of the validators (signed block hashes). No seals are included in the genesis block.")),(0,o.kt)("p",null,"When using block header validator selection, the important information in the genesis block extra data is the list of validators. All other details have empty values in the genesis block."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"When using contract validator selection to manage validators, the list of validators is configured in the ",(0,o.kt)("inlineCode",{parentName:"p"},"alloc")," property's ",(0,o.kt)("inlineCode",{parentName:"p"},"storage")," section. View the example smart contract for more information on how to generate the ",(0,o.kt)("inlineCode",{parentName:"p"},"storage")," section.")),(0,o.kt)("p",null,"Formally, ",(0,o.kt)("inlineCode",{parentName:"p"},"extraData")," in the genesis block contains:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If using block header validator selection: ",(0,o.kt)("inlineCode",{parentName:"li"},"RLP([32 bytes Vanity, List<Validators>, No Vote, Round=Int(0), 0 Seals])"),"."),(0,o.kt)("li",{parentName:"ul"},"If using contract validator selection: ",(0,o.kt)("inlineCode",{parentName:"li"},"RLP([32 bytes Vanity, 0 Validators, No Vote, Round=Int(0), 0 Seals])"),".")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"RLP encoding is a space-efficient object serialization scheme used in Ethereum.")),(0,o.kt)("h4",{id:"generate-extra-data"},"Generate extra data"),(0,o.kt)("p",null,"To generate the ",(0,o.kt)("inlineCode",{parentName:"p"},"extraData")," RLP string for inclusion in the genesis file, use the ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/cli/subcommands#rlp"},(0,o.kt)("inlineCode",{parentName:"a"},"rlp encode"))," Besu subcommand."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example"',title:'"Example"'},"besu rlp encode --from=toEncode.json --type=QBFT_EXTRA_DATA\n")),(0,o.kt)("p",null,"Where the ",(0,o.kt)("inlineCode",{parentName:"p"},"toEncode.json")," file contains a list of the initial validators, in ascending order. To write the validator address and copy it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"toEncode.json")," file, use the ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/subcommands#export-address"},(0,o.kt)("inlineCode",{parentName:"a"},"public-key export-address"))," Besu subcommand. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Initial validators in toEncode.json file"',title:'"Initial',validators:!0,in:!0,"toEncode.json":!0,'file"':!0},'[\n  "0x4592c8e45706cc08b8f44b11e43cba0cfc5892cb",\n  "0x06e23768a0f59cf365e18c2e0c89e151bcdedc70",\n  "0xc5327f96ee02d7bcbc1bf1236b8c15148971e1de",\n  "0xab5e7f4061c605820d3744227eed91ff8e2c8908"\n]\n')),(0,o.kt)("p",null,"Copy the RLP encoded data to the ",(0,o.kt)("inlineCode",{parentName:"p"},"extraData")," property in the genesis file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="RLP encoded data"',title:'"RLP',encoded:!0,'data"':!0},"0xf87aa00000000000000000000000000000000000000000000000000000000000000000f854944592c8e45706cc08b8f44b11e43cba0cfc5892cb9406e23768a0f59cf365e18c2e0c89e151bcdedc7094c5327f96ee02d7bcbc1bf1236b8c15148971e1de94ab5e7f4061c605820d3744227eed91ff8e2c8908c080c0\n")),(0,o.kt)("p",null,"When you start the network, the four nodes previously specified in ",(0,o.kt)("inlineCode",{parentName:"p"},"toEncode.json")," are the validators for the network."),(0,o.kt)("h3",{id:"block-time"},"Block time"),(0,o.kt)("p",null,"When the protocol receives a new chain head, the block time (",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds"),") timer starts. When ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," expires, the round timeout (",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds"),") timer starts and the protocol proposes a new block."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds")," expires before adding the proposed block, a round change occurs, with the block time and timeout timers reset. The timeout period for the new round is two times ",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds"),". The timeout period continues to double each time a round fails to add a block."),(0,o.kt)("p",null,"Usually, the protocol adds the proposed block before reaching ",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds"),". A new round then starts, resetting the block time and round timeout timers. When ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," expires, the protocol proposes the next new block."),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"If more than 1/3 of validators stop participating, new blocks can no longer be created and ",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds")," doubles with each round change. The quickest method to resume block production is to restart all validators, which resets ",(0,o.kt)("inlineCode",{parentName:"p"},"requesttimeoutseconds")," to its genesis value.")),(0,o.kt)("p",null,"Once ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," is over, the time from proposing a block to adding the block is small (usually around one second) even in networks with geographically dispersed validators."),(0,o.kt)("h4",{id:"tune-block-timeout"},"Tune block timeout"),(0,o.kt)("p",null,"To tune the block timeout for your network deployment:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Set ",(0,o.kt)("inlineCode",{parentName:"li"},"blockperiodseconds")," to your desired block time and ",(0,o.kt)("inlineCode",{parentName:"li"},"requesttimeoutseconds")," to two times ",(0,o.kt)("inlineCode",{parentName:"li"},"blockperiodseconds"),"."),(0,o.kt)("li",{parentName:"ol"},"Reduce ",(0,o.kt)("inlineCode",{parentName:"li"},"requesttimeoutseconds")," until you start to see round changes occurring."),(0,o.kt)("li",{parentName:"ol"},"Increase ",(0,o.kt)("inlineCode",{parentName:"li"},"requesttimeoutseconds")," to the value where round changes are no longer occurring.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"View ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/api/#admin_changeloglevel"},(0,o.kt)("inlineCode",{parentName:"a"},"TRACE")," logs")," to see round change log messages.")),(0,o.kt)("p",null,"Use a ",(0,o.kt)("a",{parentName:"p",href:"#transitions"},"transition")," to update the ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds")," in an existing network."),(0,o.kt)("h3",{id:"optional-configuration-options"},"Optional configuration options"),(0,o.kt)("p",null,"Optional configuration options in the genesis file are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"messageQueueLimit")," - In large networks with limited resources, increasing the message queue limit might help with message activity surges. The default is 1000."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"duplicateMessageLimit")," - If the same node is retransmitting messages, increasing the duplicate message limit might reduce the number of retransmissions. A value of two to three times the number of validators is usually enough. The default is 100."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"futureMessagesLimit")," - The future messages buffer holds messages for a future chain height. For large networks, increasing the future messages limit might be useful. The default is 1000."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"futureMessagesMaxDistance")," - The maximum height from the current chain height for buffering messages in the future messages buffer. The default is 10.")),(0,o.kt)("h3",{id:"post-merge-configuration"},"Post-Merge configuration"),(0,o.kt)("p",null,"After ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/concepts/the-merge"},"The Merge"),", the following block fields are modified or deprecated. Their fields ",(0,o.kt)("strong",{parentName:"p"},"must")," contain only the constant values from the following chart."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field"),(0,o.kt)("th",{parentName:"tr",align:null},"Constant value"),(0,o.kt)("th",{parentName:"tr",align:null},"Comment"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("inlineCode",{parentName:"strong"},"ommersHash"))),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"= Keccak256(RLP([]))"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("inlineCode",{parentName:"strong"},"difficulty"))),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"0")),(0,o.kt)("td",{parentName:"tr",align:null},"Replaced with ",(0,o.kt)("inlineCode",{parentName:"td"},"prevrandao"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("inlineCode",{parentName:"strong"},"mixHash"))),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"0x0000000000000000000000000000000000000000000000000000000000000000")),(0,o.kt)("td",{parentName:"tr",align:null},"Replaced with ",(0,o.kt)("inlineCode",{parentName:"td"},"prevrandao"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("inlineCode",{parentName:"strong"},"nonce"))),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"0x0000000000000000")),(0,o.kt)("td",{parentName:"tr",align:null})),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("inlineCode",{parentName:"strong"},"ommers"))),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"[]")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"RLP([]) = 0xc0"))))),(0,o.kt)("p",null,"Additionally, ",(0,o.kt)("a",{parentName:"p",href:"#extra-data"},(0,o.kt)("inlineCode",{parentName:"a"},"extraData"))," is limited to the 32 bytes of vanity data after The Merge."),(0,o.kt)("h2",{id:"add-and-remove-validators"},"Add and remove validators"),(0,o.kt)("p",null,"QBFT provides two methods to manage validators:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#add-and-remove-validators-using-block-headers"},"Block header validator selection")," - Existing validators propose and vote to add or remove validators using the QBFT JSON-RPC API methods.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#add-and-remove-validators-using-a-smart-contract"},"Contract validator selection")," - Use a smart contract to specify the validators used to propose and validate blocks."))),(0,o.kt)("p",null,"You can use ",(0,o.kt)("a",{parentName:"p",href:"#transitions"},"transitions")," to swap between block header validator selection and contract validator selection in an existing network."),(0,o.kt)("p",null,"For block header validator selection, initial validators are configured in the genesis file's ",(0,o.kt)("a",{parentName:"p",href:"#extra-data"},(0,o.kt)("inlineCode",{parentName:"a"},"extraData"))," property, whereas the initial validators when using the contract validator selection method are configured in the genesis file's ",(0,o.kt)("inlineCode",{parentName:"p"},"storage")," section."),(0,o.kt)("h3",{id:"add-and-remove-validators-using-block-headers"},"Add and remove validators using block headers"),(0,o.kt)("p",null,"Enable the HTTP interface with ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#rpc-http-enabled"},(0,o.kt)("inlineCode",{parentName:"a"},"--rpc-http-enabled"))," or the WebSockets interface with ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#rpc-ws-enabled"},(0,o.kt)("inlineCode",{parentName:"a"},"--rpc-ws-enabled")),"."),(0,o.kt)("p",null,"The QBFT API methods are disabled by default. To enable them, specify the ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#rpc-http-api"},(0,o.kt)("inlineCode",{parentName:"a"},"--rpc-http-api"))," or ",(0,o.kt)("a",{parentName:"p",href:"/public-networks/reference/cli/options#rpc-ws-api"},(0,o.kt)("inlineCode",{parentName:"a"},"--rpc-ws-api"))," option and include ",(0,o.kt)("inlineCode",{parentName:"p"},"QBFT"),"."),(0,o.kt)("p",null,"The methods to add or remove validators are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/private-networks/reference/api/#qbft_getpendingvotes"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_getPendingVotes")),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/private-networks/reference/api/#qbft_proposevalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_proposeValidatorVote")),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/private-networks/reference/api/#qbft_discardvalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_discardValidatorVote")),".")),(0,o.kt)("p",null,"To view validator metrics for a specified block range, use ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_getsignermetrics"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_getSignerMetrics")),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If network conditions render it impossible to add and remove validators by voting, you can ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/how-to/configure/consensus/add-validators-without-voting"},"add and remove validators without voting"),".")),(0,o.kt)("h4",{id:"add-a-validator"},"Add a validator"),(0,o.kt)("p",null,"To propose adding a validator, call ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_proposevalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_proposeValidatorVote")),", specifying the address of the proposed validator and ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),". A majority of validators must execute the call."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="JSON-RPC qbft_proposeValidatorVote request example"',title:'"JSON-RPC',qbft_proposeValidatorVote:!0,request:!0,'example"':!0},'curl -X POST --data \'{"jsonrpc":"2.0","method":"qbft_proposeValidatorVote","params":["0xFE3B557E8Fb62b89F4916B721be55cEb828dBd73", true], "id":1}\' <JSON-RPC-endpoint:port>\n')),(0,o.kt)("p",null,"When the validator proposes the next block, the protocol inserts one proposal received from ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_proposevalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_proposeValidatorVote"))," into the block. If blocks include all proposals, subsequent blocks proposed by the validator will not contain a vote."),(0,o.kt)("p",null,"When more than 50% of the existing validators have published a matching proposal, the protocol adds the proposed validator to the validator pool and the validator can begin validating blocks."),(0,o.kt)("p",null,"To return a list of validators and confirm the addition of a proposed validator, use ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_getvalidatorsbyblocknumber"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_getValidatorsByBlockNumber")),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="JSON-RPC qbft_getValidatorsByBlockNumber request example"',title:'"JSON-RPC',qbft_getValidatorsByBlockNumber:!0,request:!0,'example"':!0},'curl -X POST --data \'{"jsonrpc":"2.0","method":"qbft_getValidatorsByBlockNumber","params":["latest"], "id":1}\' <JSON-RPC-endpoint:port>\n')),(0,o.kt)("p",null,"To discard your proposal after confirming the addition of a validator, call ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_discardvalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_discardValidatorVote")),", specifying the address of the proposed validator."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="JSON-RPC qbft_discardValidatorVote request example"',title:'"JSON-RPC',qbft_discardValidatorVote:!0,request:!0,'example"':!0},'curl -X POST --data \'{"jsonrpc":"2.0","method":"qbft_discardValidatorVote","params":["0xFE3B557E8Fb62b89F4916B721be55cEb828dBd73"], "id":1}\' <JSON-RPC-endpoint:port>\n')),(0,o.kt)("h4",{id:"remove-a-validator"},"Remove a validator"),(0,o.kt)("p",null,"The process for removing a validator is the same as adding a validator except you specify ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," as the second parameter of ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#qbft_proposevalidatorvote"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_proposeValidatorVote")),"."),(0,o.kt)("h4",{id:"epoch-transition"},"Epoch transition"),(0,o.kt)("p",null,"At each epoch transition, QBFT discards all pending votes collected from received blocks. Existing proposals remain in effect and validators re-add their vote the next time they create a block."),(0,o.kt)("p",null,"An epoch transition occurs every ",(0,o.kt)("inlineCode",{parentName:"p"},"epochLength")," blocks. Define ",(0,o.kt)("inlineCode",{parentName:"p"},"epochlength")," in the QBFT genesis file."),(0,o.kt)("h3",{id:"add-and-remove-validators-using-a-smart-contract"},"Add and remove validators using a smart contract"),(0,o.kt)("p",null,"Users can create their own smart contracts to add or remove validators based on their organizational requirements. View the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ConsenSys/validator-smart-contracts"},"example smart contract")," for more information on how to create and deploy the smart contract."),(0,o.kt)("p",null,"You can pre-deploy the validator smart contract in a new QBFT network by specifying the contract details in the ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/how-to/configure/consensus/qbft#genesis-file"},"genesis file"),". For existing QBFT networks you need to compile and deploy the contract using a transaction, then obtain the contract address from the receipt and use that in a ",(0,o.kt)("a",{parentName:"p",href:"#swap-validator-management-methods"},"transition"),"."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You can't use the JSON-RPC methods to add or remove validators when using a smart contract to manage nodes."),(0,o.kt)("p",{parentName:"admonition"},"You must interact with the contract functions using transactions.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If network conditions render it impossible to add and remove validators using a smart contract, you can ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/how-to/configure/consensus/add-validators-without-voting#override-smart-contract-validators"},"override smart contract validators"),".")),(0,o.kt)("h3",{id:"minimum-number-of-validators"},"Minimum number of validators"),(0,o.kt)("p",null,"QBFT requires four validators to be Byzantine fault tolerant. Byzantine fault tolerance is the ability for a blockchain network to function correctly and reach consensus despite nodes failing or propagating incorrect information to peers."),(0,o.kt)("h2",{id:"transitions"},"Transitions"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"transitions")," genesis configuration item allows you to specify a future block number at which to change QBFT network configuration in an existing network. For example, you can update the ",(0,o.kt)("a",{parentName:"p",href:"#configure-block-time-on-an-existing-network"},"block time"),", ",(0,o.kt)("a",{parentName:"p",href:"#configure-block-rewards-on-an-existing-network-deployment"},"block reward"),", ",(0,o.kt)("a",{parentName:"p",href:"#swap-validator-management-methods"},"validator management method"),", or ",(0,o.kt)("a",{parentName:"p",href:"#configure-the-mining-beneficiary-on-an-existing-network-deployment"},"mining beneficiary"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Do not specify a transition block in the past. Specifying a transition block in the past could result in unexpected behavior, such as causing the network to fork.")),(0,o.kt)("h3",{id:"configure-block-time-on-an-existing-network"},"Configure block time on an existing network"),(0,o.kt)("p",null,"To update an existing network with a new ",(0,o.kt)("inlineCode",{parentName:"p"},"blockperiodseconds"),":"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop all nodes in the network.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("a",{parentName:"p",href:"#genesis-file"},"genesis file"),", add the ",(0,o.kt)("inlineCode",{parentName:"p"},"transitions")," configuration item where:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<FutureBlockNumber>")," is the upcoming block at which to change ",(0,o.kt)("inlineCode",{parentName:"li"},"blockperiodseconds"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<NewValue>")," is the updated value for ",(0,o.kt)("inlineCode",{parentName:"li"},"blockperiodseconds"),".")),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{label:"Syntax",value:"tab1",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 2,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 4\n    },\n    "transitions": {\n      "qbft": [\n        {\n          "block": <FutureBlockNumber>,\n          "blockperiodseconds": <NewValue>\n        }\n      ]\n    }\n  },\n  ...\n}\n'))),(0,o.kt)(i.Z,{label:"Example",value:"tab2",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 2,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 4\n    },\n    "transitions": {\n      "qbft": [\n        {\n          "block": 1240,\n          "blockperiodseconds": 4\n        }\n      ]\n    }\n  },\n  ...\n}\n'))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Restart all nodes in the network using the updated genesis file.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To verify the changes after the transition block, call ",(0,o.kt)("a",{parentName:"p",href:"/private-networks/reference/api/#ibft_getvalidatorsbyblocknumber"},(0,o.kt)("inlineCode",{parentName:"a"},"qbft_getValidatorsByBlockNumber")),", specifying ",(0,o.kt)("inlineCode",{parentName:"p"},"latest"),"."))),(0,o.kt)("h3",{id:"configure-block-rewards-on-an-existing-network-deployment"},"Configure block rewards on an existing network deployment"),(0,o.kt)("p",null,"To update an existing network with a new ",(0,o.kt)("inlineCode",{parentName:"p"},"blockreward"),":"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop all nodes in the network.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("a",{parentName:"p",href:"#genesis-file"},"genesis file"),", add the ",(0,o.kt)("inlineCode",{parentName:"p"},"transitions")," configuration item where:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<FutureBlockNumber>")," is the upcoming block at which to change ",(0,o.kt)("inlineCode",{parentName:"li"},"blockreward"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<NewValue>")," is the updated value for ",(0,o.kt)("inlineCode",{parentName:"li"},"blockreward"),".")),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{label:"Syntax",value:"tab1",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 2,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 4\n      "blockreward": "5000000000000000"\n    },\n    "transitions": {\n      "qbft": [\n        {\n          "block": <FutureBlockNumber>,\n          "blockreward": <NewValue>\n        },\n        {\n          "block": <FutureBlockNumber>,\n          "blockreward": <NewValue>\n        },\n        {\n          "block": <FutureBlockNumber>,\n          "blockreward": <NewValue>\n        }\n      ]\n    }\n  },\n  ...\n}\n'))),(0,o.kt)(i.Z,{label:"Example",value:"tab2",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 2,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 4\n      "blockreward": "5000000000000000"\n    },\n    "transitions": {\n      "qbft": [\n        {\n          "block": 10,\n          "blockreward": "6000000000000000"\n        },\n        {\n          "block": 15,\n          "blockreward": "75000000000000000"\n        },\n        {\n          "block": 20,\n          "blockreward": "0"\n        }\n      ]\n    }\n  },\n  ...\n}\n')))),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"You can add multiple ",(0,o.kt)("inlineCode",{parentName:"p"},"blockreward")," updates in one transition object by specifying multiple future blocks."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Restart all nodes in the network using the updated genesis file."))),(0,o.kt)("h3",{id:"swap-validator-management-methods"},"Swap validator management methods"),(0,o.kt)("p",null,"To swap between block header validator selection and contract validator selection methods in an existing network:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop all nodes in the network.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("a",{parentName:"p",href:"#genesis-file"},"genesis file"),", add the ",(0,o.kt)("inlineCode",{parentName:"p"},"transitions")," configuration item where:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<FutureBlockNumber>")," is the upcoming block at which to change the validator selection method."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<SelectionMode>")," is the validator selection mode to switch to. Valid options are ",(0,o.kt)("inlineCode",{parentName:"li"},"contract")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"blockheader"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<ContractAddress>")," is the smart contract address, if switching to the contract validator selection method.")),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{label:"Syntax",value:"tab1",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 5,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 10\n    },\n    "transitions": {\n      "qbft": [\n        {\n          "block": <FutureBlockNumber>,\n          "validatorselectionmode": <SelectionMode>,\n          "validatorcontractaddress": <ContractAddress>\n        }\n      ]\n    }\n  },\n  ...\n}\n'))),(0,o.kt)(i.Z,{label:"Example",value:"tab2",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 5,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 10\n    },\n    "transitions": {\n      "qbft": [\n      {\n        "block": 102885,\n        "validatorselectionmode": "contract",\n        "validatorcontractaddress": "0x0000000000000000000000000000000000007777"\n      }\n      ]\n    }\n  },\n  ...\n}\n'))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Restart all nodes in the network using the updated genesis file."))),(0,o.kt)("h3",{id:"configure-the-mining-beneficiary-on-an-existing-network-deployment"},"Configure the mining beneficiary on an existing network deployment"),(0,o.kt)("p",null,"To update an existing network with a new mining beneficiary:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop all nodes in the network.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("a",{parentName:"p",href:"#genesis-file"},"genesis file"),", add the ",(0,o.kt)("inlineCode",{parentName:"p"},"transitions")," configuration item where:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<FutureBlockNumber>")," is the upcoming block at which to change ",(0,o.kt)("inlineCode",{parentName:"li"},"miningbeneficiary"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<NewAddress>")," is the updated 20-byte address for ",(0,o.kt)("inlineCode",{parentName:"li"},"miningbeneficiary"),". Starting at ",(0,o.kt)("inlineCode",{parentName:"li"},"<FutureBlockNumber>"),", block rewards go to this address.")),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{label:"Syntax",value:"tab1",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 5,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 10\n    },\n    "transitions": {\n      "qbft": [\n      {\n        "block": <FutureBlockNumber>,\n        "miningbeneficiary": <NewAddress>\n      },\n      {\n        "block": <FutureBlockNumber>,\n        "miningbeneficiary": <NewAddress>\n      }\n      ]\n    }\n  },\n  ...\n}\n'))),(0,o.kt)(i.Z,{label:"Example",value:"tab2",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "config": {\n    ...\n    "qbft": {\n      "blockperiodseconds": 5,\n      "epochlength": 30000,\n      "requesttimeoutseconds": 10\n    },\n    "transitions": {\n      "qbft": [\n      {\n        "block": 10000,\n        "miningbeneficiary": "0x0000000000000000000000000000000000000002",\n      },\n      {\n        "block": 20000,\n        "miningbeneficiary": "",\n      }\n      ]\n    }\n  },\n  ...\n}\n')))),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Setting the ",(0,o.kt)("inlineCode",{parentName:"p"},"miningbeneficiary")," to an empty value clears out any override so that block rewards go to the block producer rather than a global override address."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Restart all nodes in the network using the updated genesis file."))),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"[vanity data]",": Validators can include anything they like as vanity data. "),"[RLP]",": Recursive Length Prefix"))}u.isMDXComponent=!0}}]);